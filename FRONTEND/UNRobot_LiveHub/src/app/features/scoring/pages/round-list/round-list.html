<div class="max-w-4xl mx-auto">
  <app-back-button />
  
  <h1 class="font-heading text-4xl font-bold text-unrobot-blue mb-4">
    Gestionar: <span class="text-brand-dark">{{ categoryId }}</span>
  </h1>

  <div *ngIf="errorMessage" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4">
    <p class="font-bold">Error</p>
    <p>{{ errorMessage }}</p>
  </div>


  <div *ngIf="categoryType === 'ENFRENTAMIENTO'">
    
    <div class="mb-6 p-4 bg-gray-100 rounded-lg shadow-sm flex space-x-4">
      <button (click)="generateBrackets()" [disabled]="isBusy" 
              class="bg-unrobot-gold text-brand-dark font-bold py-2 px-4 rounded-lg font-heading hover:bg-opacity-90 transition-all disabled:bg-gray-400">
        {{ isBusy ? 'Procesando...' : 'Generar Llaves' }}
      </button>
      <button (click)="advanceRound()" [disabled]="isBusy" 
              class="bg-brand-dark text-white font-bold py-2 px-4 rounded-lg font-heading hover:bg-opacity-90 transition-all disabled:bg-gray-400">
        {{ isBusy ? 'Procesando...' : 'Avanzar Ronda' }}
      </button>
    </div>

    <div class="mb-6">
      <button (click)="loadMatches()" [disabled]="isBusy" 
              class="w-full py-3 px-5 bg-unrobot-blue text-white font-bold rounded-lg font-heading text-lg hover:bg-opacity-90 transition-all disabled:bg-gray-400">
        {{ isBusy ? 'Cargando...' : 'Cargar/Actualizar Matches' }}
      </button>
    </div>
    
    <div *ngIf="matches.length > 0; else emptyStateMatches" class="space-y-4">
      <app-confrontation-list-item
        *ngFor="let match of matches" 
        [matchData]="match"
        (onScore)="navigateToMatchScoring($event)">
      </app-confrontation-list-item>
    </div>
    
    <ng-template #emptyStateMatches>
      <div *ngIf="dataLoaded && !isBusy" class="text-center p-12 bg-gray-50 rounded-lg">
        <p class="font-sans text-lg text-gray-500">No hay matches para mostrar.</p>
        <p class="text-gray-400">(Quizás necesites "Generar Llaves".)</p>
      </div>
    </ng-template>

  </div>
  

  <div *ngIf="categoryType === 'RONDA_INDIVIDUAL'">
    
    <form [formGroup]="createRoundForm" (ngSubmit)="onSubmitNewRound()" 
          class="bg-white p-8 rounded-lg shadow-lg border border-gray-200 space-y-6">
      
      <h2 class="font-heading text-2xl font-semibold text-gray-800">
        Registrar Nuevo Intento (Ronda)
      </h2>
      <p class="font-sans text-gray-600">
        Selecciona el equipo e ingresa los datos de su participación.
      </p>

      <div>
        <label for="idEquipo" class="block text-sm font-medium text-gray-700">Equipo</label>
        <select id="idEquipo" formControlName="idEquipo"
                class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg ...">
          <option value="" disabled>-- Selecciona un equipo --</option>
          <ng-container *ngIf="teams$ | async as teams">
            <option *ngFor="let team of teams" [value]="team.id">
              {{ team.nombre }} ({{ team.institucion }})
            </option>
          </ng-container>
        </select>
        <div *ngIf="createRoundForm.get('idEquipo')?.invalid && createRoundForm.get('idEquipo')?.touched" 
             class="text-red-600 text-sm mt-1">
          Debes seleccionar un equipo.
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="tiempoMs" class="block text-sm font-medium text-gray-700">Tiempo (en Milisegundos)</label>
          <input id="tiempoMs" type="number" formControlName="tiempoMs"
                 class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg ...">
          <div *ngIf="createRoundForm.get('tiempoMs')?.invalid && createRoundForm.get('tiempoMs')?.touched" 
               class="text-red-600 text-sm mt-1">
            Tiempo inválido.
          </div>
        </div>

        <div>
          <label for="penalizaciones" class="block text-sm font-medium text-gray-700">Penalizaciones (Nº)</label>
          <input id="penalizaciones" type="number" formControlName="penalizaciones"
                 class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg ...">
          <div *ngIf="createRoundForm.get('penalizaciones')?.invalid && createRoundForm.get('penalizaciones')?.touched" 
               class="text-red-600 text-sm mt-1">
            Valor inválido.
          </div>
        </div>
      </div>
      
      <div>
        <label for="etiquetaRonda" class="block text-sm font-medium text-gray-700">Etiqueta de Ronda</label>
        <input id="etiquetaRonda" type="text" formControlName="etiquetaRonda"
               class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg ...">
      </div>
      <button 
        type="submit"
        [disabled]="createRoundForm.invalid || isBusy"
        class="w-full py-4 px-6 rounded-lg font-heading font-semibold text-lg transition-colors
               bg-unrobot-blue text-white
               hover:bg-opacity-90
               focus:outline-none focus:ring-2 focus:ring-unrobot-gold
               disabled:bg-gray-400 disabled:cursor-not-allowed">
        {{ isBusy ? 'Guardando...' : 'Registrar Intento' }}
      </button>
    </form>
    
  </div>
</div>